id: com.valvesoftware.Steam.Utility.steamtinkerlaunch
default-branch: stable
sdk: org.freedesktop.Sdk//21.08
runtime: com.valvesoftware.Steam
runtime-version: stable
build-extension: true
appstream-compose: false
rename-icon: steamtinkerlaunch
rename-desktop-file: steamtinkerlaunch.desktop
build-options:
  prefix: /app/utils/steamtinkerlaunch
  prepend-path: /app/utils/steamtinkerlaunch/bin
  append-pkg-config-path: /app/utils/steamtinkerlaunch/lib/pkgconfig
  strip: true
modules:
  - name: yad
    config-opts:
      - "--enable-standalone"
    sources:
      - type: archive
        url: https://github.com/v1cont/yad/releases/download/v11.1/yad-11.1.tar.xz
        sha256: ca61d422d6d464d7f473d1e5bd14d3ca05d311ef203f1c67bbea7c23bf0eae2f
    modules:
      - name: intltool
        cleanup:
          - "*"
        sources:
          - type: archive
            url: "https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz"
            sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: xprop
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/app/xprop-1.2.5.tar.gz
        sha256: b7bf6b6be6cf23e7966a153fc84d5901c14f01ee952fbd9d930aa48e2385d670

  - name: git
    make-args:
      - INSTALL_SYMLINKS=1
      - NO_PERL=YesPlease
      - NO_TCLTK=YesPlease
    make-install-args:
      - INSTALL_SYMLINKS=1
      - NO_PERL=YesPlease
      - NO_TCLTK=YesPlease
    sources:
      - type: archive
        url: https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.36.0.tar.xz
        sha256: af5ebfc1658464f5d0d45a2bfd884c935fb607a10cc021d95bc80778861cc1d3

  - name: xdotool
    no-autogen: true
    make-args:
      - WITHOUT_RPATH_FIX=1
    make-install-args:
      - 'PREFIX=${FLATPAK_DEST}'
      - 'INSTALLMAN=${FLATPAK_DEST}/share/man'
    sources:
      - type: archive
        url: https://github.com/jordansissel/xdotool/archive/v3.20211022.1/xdotool-3.20211022.1.tar.gz
        sha256: 82b15a944a5e82fee15e0f6116bd9f642bc3d0bb6989fc0ca5ad9dfe35de0847
        x-checker-data:
          type: anitya
          project-id: 8648
          stable-only: true
          url-template: https://github.com/jordansissel/xdotool/archive/v$version/xdotool-$version.tar.gz
    cleanup:
      - /share/man

  - name: xwininfo
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/app/xwininfo-1.1.5.tar.bz2
        md5: 26d46f7ef0588d3392da3ad5802be420

  - name: xxd
    buildsystem: simple
    build-commands:
     - make -C src/xxd
     - install -Dt /app/utils/steamtinkerlaunch/bin src/xxd/xxd
    sources:
      - type: git
        url: https://github.com/vim/vim
        tag: v8.2.4814
        commit: 4a392d244018fadda375a490f4f4b921023248b9

  - name: steamtinkerlaunch
    build-options:
      env:
        PREFIX: /app/utils/steamtinkerlaunch
    buildsystem: simple
    build-commands:
      - make install
      - install -Dm644 -t ${FLATPAK_DEST}/share/steam/compatibilitytools.d compatibilitytool.vdf
      - install -Dm644 -t ${FLATPAK_DEST}/share/steam/compatibilitytools.d toolmanifest.vdf
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
      # - ln -s ${FLATPAK_DEST}/bin/steamtinkerlaunch ${FLATPAK_DEST}/share/steam/compatibilitytools.d
    sources:
      - type: git
        url: https://github.com/frostworx/steamtinkerlaunch.git
        tag: v10.0
        commit: 39bacab0c2bf1a9338e7385b4035753c0a197907
      - type: file
        path: com.valvesoftware.Steam.Utility.steamtinkerlaunch.metainfo.xml
      - type: file
        path: compatibilitytool.vdf
      - type: file
        path: toolmanifest.vdf